@page "{id:int}"
@model Database_Final_Project.Pages.Instructor.Reports.ViewReport5Model
@{
    ViewData["Title"] = "Exam Paper Preview";
    string[] letters = { "a", "b", "c", "d", "e", "f" };
}

<div class="container py-4">
    <div class="d-flex justify-content-between mb-4 no-print">
        <a asp-page="/Instructor/InstructorDashboard" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Back to Dashboard
        </a>
        @if (string.IsNullOrEmpty(Model.ErrorMessage))
        {
            <button onclick="window.print()" class="btn btn-info shadow fw-bold text-white">
                <i class="bi bi-printer"></i> Print Exam Paper
            </button>
        }
    </div>

    @if (!string.IsNullOrEmpty(Model.ErrorMessage))
    {
        <div class="alert alert-danger shadow border-start border-4 border-info">
            <h4 class="alert-heading">Validation Error</h4>
            <p class="mb-0">@Model.ErrorMessage</p>
        </div>
    }
    else
    {
        <div class="report-paper mx-auto shadow-lg p-5 mb-5 bg-white border">
            <div class="text-center border-bottom border-3 pb-3 mb-4">
                <h2 class="fw-bold text-uppercase">Final Examination</h2>
                <div class="d-flex justify-content-between mt-3 px-3">
                    <span><strong>Exam ID:</strong> #@RouteData.Values["id"]</span>
                    <span><strong>Total Questions:</strong> @Model.Questions.Count</span>
                    <span><strong>Total Marks:</strong> @Model.Questions.Sum(q => q.Mark)</span>
                </div>
            </div>

            <div class="row mb-5 pb-3 border-bottom border-dotted">
                <div class="col-8"><strong>Student Name:</strong> __________________________________________</div>
                <div class="col-4 text-end"><strong>ID:</strong> ______________</div>
            </div>

            <div class="questions-container">
                @{
                    int qNum = 1;
                }
                @foreach (var q in Model.Questions)
                {
                    <div class="mb-5 pb-2 question-block">
                        <div class="d-flex justify-content-between align-items-baseline">
                            <h6 class="fw-bold">
                                @qNum. @q.Description
                                <span class="ms-2 badge bg-light text-dark border fw-normal" style="font-size: 0.7rem;">@q.Type</span>
                            </h6>
                            <span class="small">(@q.Mark Marks)</span>
                        </div>

                        @if (q.Type == "MCQ" && !string.IsNullOrEmpty(q.Options))
                        {
                            var optionsList = q.Options.Split(new[] { " | " }, StringSplitOptions.RemoveEmptyEntries);
                            <div class="ms-4 mt-2 row">
                                @for (int i = 0; i < optionsList.Length; i++)
                                {
                                    <div class="col-6 mb-2">
                                        <span class="fw-bold me-2">@letters[i])</span>
                                        <span class="border-bottom border-1 d-inline-block" style="min-width: 15px;"></span>
                                        @optionsList[i].Trim()
                                    </div>
                                }
                            </div>
                        }
                        else if (q.Type == "TF")
                        {
                            <div class="ms-4 mt-2">
                                <span class="me-5"><i class="bi bi-circle"></i> True</span>
                                <span><i class="bi bi-circle"></i> False</span>
                            </div>
                        }
                    </div>
                    qNum++;
                }
            </div>

            <div class="mt-5 pt-5 text-center text-muted small border-top">
                *** End of Exam - Good Luck ***
            </div>
        </div>
    }
</div>

<style>
    .report-paper {
        max-width: 850px;
        min-height: 1100px;
        color: black;
        font-family: 'Times New Roman', Times, serif;
    }

    .question-block {
        page-break-inside: avoid;
    }

    .border-dotted {
        border-style: dotted !important;
    }

    @@media print {
        .no-print {
            display: none !important;
        }

        .report-paper {
            box-shadow: none !important;
            border: none !important;
            width: 100% !important;
            margin: 0 !important;
        }

        body {
            background-color: white !important;
        }
    }

    body {
        background-color: #f4f4f4;
    }
</style>