@page "{examId:int}/{studentId:int}"
@model Database_Final_Project.Pages.Instructor.Reports.ViewReport6Model
@{
    ViewData["Title"] = "Student Exam Review";
}

<div class="container py-4">
    <div class="d-flex justify-content-between mb-4 no-print">
        <a asp-page="/Instructor/InstructorDashboard" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Back to Dashboard
        </a>
        @if (string.IsNullOrEmpty(Model.ErrorMessage))
        {
            <button onclick="window.print()" class="btn btn-dark shadow">
                <i class="bi bi-printer"></i> Print Results
            </button>
        }
    </div>

    @if (!string.IsNullOrEmpty(Model.ErrorMessage))
    {
        <div class="alert alert-danger shadow border-start border-4 border-dark">
            <h4 class="alert-heading"><i class="bi bi-search me-2"></i>Report Error</h4>
            <p class="mb-0">@Model.ErrorMessage</p>
        </div>
    }
    else
    {
        <div class="report-paper mx-auto shadow-lg p-5 mb-5 bg-white border">

            <div class="text-center mb-4">
                <h2 class="fw-bold text-dark text-uppercase">Exam Performance Review</h2>
                <h5 class="text-primary">Course: @(Model.ExamInfo?.Crs?.CourseName ?? "N/A")</h5>
                <hr class="border-dark opacity-75" />
            </div>

            <div class="row mb-4">
                <div class="col-md-6">
                    <p class="mb-1 text-muted small text-uppercase">Student Details</p>
                    <h6 class="fw-bold">@Model.StudentName (ID: @RouteData.Values["studentId"])</h6>
                    <p class="mb-0 text-muted">Exam ID: #@RouteData.Values["examId"]</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-1 text-muted small text-uppercase">Performance Summary</p>
                    <h6 class="fw-bold">Duration: @Model.ExamInfo?.ExamDurationMins mins</h6>
                    <h3 class="fw-bold @(Model.Results.Sum(r => r.EarnedGrade) >= (Model.Results.Sum(r => r.MaxMark) / 2) ? "text-success" : "text-danger") mb-0">
                        Total Score: @Model.Results.Sum(r => r.EarnedGrade) / @Model.Results.Sum(r => r.MaxMark)
                    </h3>
                </div>
            </div>

            <table class="table table-bordered align-middle mt-4">
                <thead class="table-dark text-uppercase small">
                    <tr>
                        <th style="width: 45%;">Question Detail</th>
                        <th class="text-center">Student Choice</th>
                        <th class="text-center">Model Answer</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var r in Model.Results)
                    {
                        bool isCorrect = r.EarnedGrade > 0;
                        <tr class="@(isCorrect ? "" : "bg-light-danger")">
                            <td>
                                <div class="fw-bold">@r.Question</div>
                                <div class="small text-muted mt-1">Weight: @r.MaxMark Points</div>
                            </td>
                            <td class="text-center @(isCorrect ? "text-success" : "text-danger") fw-bold">
                                @r.StudentAnswer
                            </td>
                            <td class="text-center fw-bold text-primary">@r.ModelAnswer</td>
                            <td class="text-center">
                                @if (isCorrect)
                                {
                                    <i class="bi bi-check-circle-fill text-success fs-5"></i>
                                }
                                else
                                {
                                    <i class="bi bi-x-circle-fill text-danger fs-5"></i>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>

            <div class="mt-5 pt-4 border-top text-center text-muted small">
                Generated by Instructor Portal Reporting Engine &copy; @DateTime.Now.Year
            </div>
        </div>
    }
</div>

<style>
    .report-paper {
        max-width: 900px;
        min-height: 1100px;
        font-family: 'Segoe UI', Tahoma, sans-serif;
    }

    .bg-light-danger {
        background-color: #fff8f8;
    }

    .table th {
        font-size: 0.8rem;
        letter-spacing: 1px;
    }

    @@media print {
        .no-print {
            display: none;
        }

        .report-paper {
            border: none !important;
            box-shadow: none !important;
            width: 100% !important;
            margin: 0 !important;
        }

        body {
            background-color: white !important;
        }
    }
</style>