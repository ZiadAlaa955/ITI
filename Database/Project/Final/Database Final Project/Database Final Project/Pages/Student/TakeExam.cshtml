@page "{courseId:int}"
@model Database_Final_Project.Pages.Student.TakeExamModel

<div class="container py-4">
    @if (!string.IsNullOrEmpty(Model.ErrorMessage))
    {
        <div class="alert alert-danger">@Model.ErrorMessage</div>
    }
    else
    {
        <div class="d-flex justify-content-between sticky-top bg-white p-3 border-bottom shadow-sm">
            <h4>Exam #@Model.ExamId</h4>
            <div class="badge bg-danger fs-5" id="timer">@Model.Duration:00</div>
        </div>

        <form id="examForm" method="post" class="mt-4">
            <input type="hidden" name="ExamId" value="@Model.ExamId" />

            @foreach (var q in Model.Questions)
            {
                <div class="card mb-3 shadow-sm">
                    <div class="card-body">
                        <h5 class="fw-bold">@q.QDescription <small class="text-muted">(@q.Mark Marks)</small></h5>
                        <hr />
                        @if (q.QType == "MCQ")
                        {
                            var opts = q.Options.Split(" | ");
                            foreach (var opt in opts)
                            {
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q_@q.QDescription" value="@opt" required>
                                    <label class="form-check-label">@opt</label>
                                </div>
                            }
                        }
                        else
                        {
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="q_@q.QDescription" value="True" required>
                                <label class="form-check-label">True</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="q_@q.QDescription" value="False" required>
                                <label class="form-check-label">False</label>
                            </div>
                        }
                    </div>
                </div>
            }
            <button type="submit" class="btn btn-primary btn-lg w-100 mt-4 shadow">Submit Exam</button>
        </form>
    }
</div>

<script>
    let seconds = @Model.Duration * 60;
    const timerBox = document.getElementById('timer');
    const interval = setInterval(() => {
        let m = Math.floor(seconds / 60);
        let s = seconds % 60;
        timerBox.innerText = `${m}:${s < 10 ? '0' : ''}${s}`;
        if (seconds <= 0) {
            clearInterval(interval);
            document.getElementById('examForm').submit();
        }
        seconds--;
    }, 1000);
</script>